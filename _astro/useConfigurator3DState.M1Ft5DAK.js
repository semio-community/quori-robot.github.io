import{j as L}from"./jsx-runtime.D_zvdyIk.js";import{V as kt,e as N,Q as ft,M as Ue,f as dn,g as At,h as Ge,E as pn,u as ct,i as Gt,j as mn,k as yn,l as vn,m as vt,n as gn}from"./spec.ISvk-yXP.js";import{R as ut,r as h}from"./index.CC6F48bw.js";import{i as _n,r as bn,m as wn,a as En,b as Ye,d as Mn,c as An,f as Sn,e as In,s as xn,p as On,V as Tn,g as Cn,h as Dn,j as Pn,S as kn,H as Rn,v as wt,k as Vn,l as Ln,n as jn}from"./single-value.CDymzU1p.js";const cr=[0,1e3,0];function zn(e,t,n){return Math.max(t,Math.min(e,n))}const I={toVector(e,t){return e===void 0&&(e=t),Array.isArray(e)?e:[e,e]},add(e,t){return[e[0]+t[0],e[1]+t[1]]},sub(e,t){return[e[0]-t[0],e[1]-t[1]]},addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function Yt(e,t,n){return t===0||Math.abs(t)===1/0?Math.pow(e,n*5):e*t*n/(t+n*e)}function Ht(e,t,n,i=.15){return i===0?zn(e,t,n):e<t?-Yt(t-e,n-t,i)+t:e>n?+Yt(e-n,n-t,i)+n:e}function Bn(e,[t,n],[i,s]){const[[r,o],[a,c]]=e;return[Ht(t,r,o,i),Ht(n,a,c,s)]}function Kn(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Un(e){var t=Kn(e,"string");return typeof t=="symbol"?t:String(t)}function k(e,t,n){return t=Un(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Nt(Object(n),!0).forEach(function(i){k(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nt(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const He={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function Wt(e){return e?e[0].toUpperCase()+e.slice(1):""}const Gn=["enter","leave"];function Yn(e=!1,t){return e&&!Gn.includes(t)}function Hn(e,t="",n=!1){const i=He[e],s=i&&i[t]||t;return"on"+Wt(e)+Wt(s)+(Yn(n,s)?"Capture":"")}const Nn=["gotpointercapture","lostpointercapture"];function Wn(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const i=Nn.includes(t)?"capturecapture":"capture",s=!!~t.indexOf(i);return s&&(t=t.replace("capture","")),{device:t,capture:s,passive:n}}function Fn(e,t=""){const n=He[e],i=n&&n[t]||t;return e+i}function St(e){return"touches"in e}function Ne(e){return St(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function qn(e){return Array.from(e.touches).filter(t=>{var n,i;return t.target===e.currentTarget||((n=e.currentTarget)===null||n===void 0||(i=n.contains)===null||i===void 0?void 0:i.call(n,t.target))})}function Xn(e){return e.type==="touchend"||e.type==="touchcancel"?e.changedTouches:e.targetTouches}function We(e){return St(e)?Xn(e)[0]:e}function Tt(e,t){try{const n=t.clientX-e.clientX,i=t.clientY-e.clientY,s=(t.clientX+e.clientX)/2,r=(t.clientY+e.clientY)/2,o=Math.hypot(n,i);return{angle:-(Math.atan2(n,i)*180)/Math.PI,distance:o,origin:[s,r]}}catch{}return null}function $n(e){return qn(e).map(t=>t.identifier)}function Ft(e,t){const[n,i]=Array.from(e.touches).filter(s=>t.includes(s.identifier));return Tt(n,i)}function It(e){const t=We(e);return St(e)?t.identifier:t.pointerId}function Z(e){const t=We(e);return[t.clientX,t.clientY]}const qt=40,Xt=800;function Fe(e){let{deltaX:t,deltaY:n,deltaMode:i}=e;return i===1?(t*=qt,n*=qt):i===2&&(t*=Xt,n*=Xt),[t,n]}function Qn(e){var t,n;const{scrollX:i,scrollY:s,scrollLeft:r,scrollTop:o}=e.currentTarget;return[(t=i??r)!==null&&t!==void 0?t:0,(n=s??o)!==null&&n!==void 0?n:0]}function Zn(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:i,metaKey:s,ctrlKey:r}=e;Object.assign(t,{shiftKey:n,altKey:i,metaKey:s,ctrlKey:r})}return t}function Et(e,...t){return typeof e=="function"?e(...t):e}function Jn(){}function ti(...e){return e.length===0?Jn:e.length===1?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function $t(e,t){return Object.assign({},t,e||{})}const ei=32;class qe{constructor(t,n,i){this.ctrl=t,this.args=n,this.key=i,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:n,ingKey:i,args:s}=this;n[i]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=s,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const n=this.state,i=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=t.target,n.currentTarget=t.currentTarget,n.lastOffset=i.from?Et(i.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=t.timeStamp)}computeValues(t){const n=this.state;n._values=t,n.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:n,config:i,shared:s}=this;n.args=this.args;let r=0;if(t&&(n.event=t,i.preventDefault&&t.cancelable&&n.event.preventDefault(),n.type=t.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,Zn(t)),s.down=s.pressed=s.buttons%2===1||s.touches>0,r=t.timeStamp-n.timeStamp,n.timeStamp=t.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const f=n._delta.map(Math.abs);I.addTo(n._distance,f)}this.axisIntent&&this.axisIntent(t);const[o,a]=n._movement,[c,u]=i.threshold,{_step:l,values:d}=n;if(i.hasCustomTransform?(l[0]===!1&&(l[0]=Math.abs(o)>=c&&d[0]),l[1]===!1&&(l[1]=Math.abs(a)>=u&&d[1])):(l[0]===!1&&(l[0]=Math.abs(o)>=c&&Math.sign(o)*c),l[1]===!1&&(l[1]=Math.abs(a)>=u&&Math.sign(a)*u)),n.intentional=l[0]!==!1||l[1]!==!1,!n.intentional)return;const b=[0,0];if(i.hasCustomTransform){const[f,m]=d;b[0]=l[0]!==!1?f-l[0]:0,b[1]=l[1]!==!1?m-l[1]:0}else b[0]=l[0]!==!1?o-l[0]:0,b[1]=l[1]!==!1?a-l[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(b);const E=n.offset,v=n._active&&!n._blocked||n.active;v&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=s[this.ingKey]=n._active,t&&(n.first&&("bounds"in i&&(n._bounds=Et(i.bounds,n)),this.setup&&this.setup()),n.movement=b,this.computeOffset()));const[w,p]=n.offset,[[g,_],[M,A]]=n._bounds;n.overflow=[w<g?-1:w>_?1:0,p<M?-1:p>A?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const x=n._active?i.rubberband||[0,0]:[0,0];if(n.offset=Bn(n._bounds,n.offset,x),n.delta=I.sub(n.offset,E),this.computeMovement(),v&&(!n.last||r>ei)){n.delta=I.sub(n.offset,E);const f=n.delta.map(Math.abs);I.addTo(n.distance,f),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&r>0&&(n.velocity=[f[0]/r,f[1]/r],n.timeDelta=r)}}emit(){const t=this.state,n=this.shared,i=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!i.triggerAllEvents)return;const s=this.handler(C(C(C({},n),t),{},{[this.aliasKey]:t.values}));s!==void 0&&(t.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function ni([e,t],n){const i=Math.abs(e),s=Math.abs(t);if(i>s&&i>n)return"x";if(s>i&&s>n)return"y"}class ht extends qe{constructor(...t){super(...t),k(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=I.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=I.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const n=this.state,i=this.config;if(!n.axis&&t){const s=typeof i.axisThreshold=="object"?i.axisThreshold[Ne(t)]:i.axisThreshold;n.axis=ni(n._movement,s)}n._blocked=(i.lockDirection||!!i.axis)&&!n.axis||!!i.axis&&i.axis!==n.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const ii=e=>e,Qt=.15,Xe={enabled(e=!0){return e},eventOptions(e,t,n){return C(C({},n.shared.eventOptions),e)},preventDefault(e=!1){return e},triggerAllEvents(e=!1){return e},rubberband(e=0){switch(e){case!0:return[Qt,Qt];case!1:return[0,0];default:return I.toVector(e)}},from(e){if(typeof e=="function")return e;if(e!=null)return I.toVector(e)},transform(e,t,n){const i=e||n.shared.transform;return this.hasCustomTransform=!!i,i||ii},threshold(e){return I.toVector(e,0)}},si=0,W=C(C({},Xe),{},{axis(e,t,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(e=si){return e},bounds(e={}){if(typeof e=="function")return r=>W.bounds(e(r));if("current"in e)return()=>e.current;if(typeof HTMLElement=="function"&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:i=-1/0,bottom:s=1/0}=e;return[[t,n],[i,s]]}}),Zt={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class ri extends ht{constructor(...t){super(...t),k(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const n=t._bounds.getBoundingClientRect(),i=t.currentTarget.getBoundingClientRect(),s={left:n.left-i.left+t.offset[0],right:n.right-i.right+t.offset[0],top:n.top-i.top+t.offset[1],bottom:n.bottom-i.bottom+t.offset[1]};t._bounds=W.bounds(s)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const n=this.config,i=this.state;if(t.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(t.buttons):n.pointerButtons!==-1&&n.pointerButtons!==t.buttons))return;const s=this.ctrl.setEventIds(t);n.pointerCapture&&t.target.setPointerCapture(t.pointerId),!(s&&s.size>1&&i._pointerActive)&&(this.start(t),this.setupPointer(t),i._pointerId=It(t),i._pointerActive=!0,this.computeValues(Z(t)),this.computeInitial(),n.preventScrollAxis&&Ne(t)!=="mouse"?(i._active=!1,this.setupScrollPrevention(t)):n.delay>0?(this.setupDelayTrigger(t),n.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const n=this.state,i=this.config;if(!n._pointerActive)return;const s=It(t);if(n._pointerId!==void 0&&s!==n._pointerId)return;const r=Z(t);if(document.pointerLockElement===t.target?n._delta=[t.movementX,t.movementY]:(n._delta=I.sub(r,n._values),this.computeValues(r)),I.addTo(n._movement,n._delta),this.compute(t),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(t);return}if(i.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===i.preventScrollAxis||i.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(t);return}else return;this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch{}const n=this.state,i=this.config;if(!n._active||!n._pointerActive)return;const s=It(t);if(n._pointerId!==void 0&&s!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[r,o]=n._distance;if(n.tap=r<=i.tapsThreshold&&o<=i.tapsThreshold,n.tap&&i.filterTaps)n._force=!0;else{const[a,c]=n._delta,[u,l]=n._movement,[d,b]=i.swipe.velocity,[E,v]=i.swipe.distance,w=i.swipe.duration;if(n.elapsedTime<w){const p=Math.abs(a/n.timeDelta),g=Math.abs(c/n.timeDelta);p>d&&Math.abs(u)>E&&(n.swipe[0]=Math.sign(a)),g>b&&Math.abs(l)>v&&(n.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const n=this.config,i=n.device;n.pointerLock&&t.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,i,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,oi(t);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(t)},this.config.delay)}keyDown(t){const n=Zt[t.key];if(n){const i=this.state,s=t.shiftKey?10:t.altKey?.1:1;this.start(t),i._delta=n(this.config.keyboardDisplacement,s),i._keyboardActive=!0,I.addTo(i._movement,i._delta),this.compute(t),this.emit()}}keyUp(t){t.key in Zt&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const n=this.config.device;t(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(n,"change",this.pointerMove.bind(this)),t(n,"end",this.pointerUp.bind(this)),t(n,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function oi(e){"persist"in e&&typeof e.persist=="function"&&e.persist()}const dt=typeof window<"u"&&window.document&&window.document.createElement;function $e(){return dt&&"ontouchstart"in window}function ai(){return $e()||dt&&window.navigator.maxTouchPoints>1}function ci(){return dt&&"onpointerdown"in window}function ui(){return dt&&"exitPointerLock"in window.document}function li(){try{return"constructor"in GestureEvent}catch{return!1}}const z={isBrowser:dt,gesture:li(),touch:$e(),touchscreen:ai(),pointer:ci(),pointerLock:ui()},fi=250,hi=180,di=.5,pi=50,mi=250,yi=10,Jt={mouse:0,touch:0,pen:8},vi=C(C({},W),{},{device(e,t,{pointer:{touch:n=!1,lock:i=!1,mouse:s=!1}={}}){return this.pointerLock=i&&z.pointerLock,z.touch&&n?"touch":this.pointerLock?"mouse":z.pointer&&!s?"pointer":z.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&e?fi:void 0,!(!z.touchscreen||n===!1))return e||(n!==void 0?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:i=1,keys:s=!0}={}}){return this.pointerButtons=i,this.keys=s,!this.pointerLock&&this.device==="pointer"&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:i=3,axis:s=void 0}){const r=I.toVector(e,n?i:s?1:0);return this.filterTaps=n,this.tapsThreshold=i,r},swipe({velocity:e=di,distance:t=pi,duration:n=mi}={}){return{velocity:this.transform(I.toVector(e)),distance:this.transform(I.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return hi;case!1:return 0;default:return e}},axisThreshold(e){return e?C(C({},Jt),e):Jt},keyboardDisplacement(e=yi){return e}});function Qe(e){const[t,n]=e.overflow,[i,s]=e._delta,[r,o]=e._direction;(t<0&&i>0&&r<0||t>0&&i<0&&r>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&s>0&&o<0||n>0&&s<0&&o>0)&&(e._movement[1]=e._movementBound[1])}const gi=30,_i=100;class bi extends qe{constructor(...t){super(...t),k(this,"ingKey","pinching"),k(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:n,lastOffset:i}=this.state;t==="wheel"?this.state.offset=I.add(n,i):this.state.offset=[(1+n[0])*i[0],n[1]+i[1]]}computeMovement(){const{offset:t,lastOffset:n}=this.state;this.state.movement=[t[0]/n[0],t[1]-n[1]]}axisIntent(){const t=this.state,[n,i]=t._movement;if(!t.axis){const s=Math.abs(n)*gi-Math.abs(i);s<0?t.axis="angle":s>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&(this.state.axis==="scale"?t[1]=0:this.state.axis==="angle"&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const n=this.state,i=this.ctrl.touchIds;if(n._active&&n._touchIds.every(r=>i.has(r))||i.size<2)return;this.start(t),n._touchIds=Array.from(i).slice(0,2);const s=Ft(t,n._touchIds);s&&this.pinchStart(t,s)}pointerStart(t){if(t.buttons!=null&&t.buttons%2!==1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const n=this.state,i=n._pointerEvents,s=this.ctrl.pointerIds;if(n._active&&Array.from(i.keys()).every(o=>s.has(o))||(i.size<2&&i.set(t.pointerId,t),n._pointerEvents.size<2))return;this.start(t);const r=Tt(...Array.from(i.values()));r&&this.pinchStart(t,r)}pinchStart(t,n){const i=this.state;i.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const n=Ft(t,this.state._touchIds);n&&this.pinchMove(t,n)}pointerMove(t){const n=this.state._pointerEvents;if(n.has(t.pointerId)&&n.set(t.pointerId,t),!this.state._active)return;const i=Tt(...Array.from(n.values()));i&&this.pinchMove(t,i)}pinchMove(t,n){const i=this.state,s=i._values[1],r=n.angle-s;let o=0;Math.abs(r)>270&&(o+=Math.sign(r)),this.computeValues([n.distance,n.angle-360*o]),i.origin=n.origin,i.turns=o,i._movement=[i._values[0]/i._initial[0]-1,i._values[1]-i._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const n=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch{}n._pointerEvents.has(t.pointerId)&&n._pointerEvents.delete(t.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const n=this.state;n._active||(this.start(t),this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY];const i=n._movement;n._movement=[t.scale-1,t.rotation],n._delta=I.sub(n._movement,i),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(i=>t[i]):!t[n])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const i=this.state;i._delta=[-Fe(t)[1]/_i*i.offset[0],0],I.addTo(i._movement,i._delta),Qe(i),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const n=this.config.device;n&&(t(n,"start",this[n+"Start"].bind(this)),t(n,"change",this[n+"Move"].bind(this)),t(n,"end",this[n+"End"].bind(this)),t(n,"cancel",this[n+"End"].bind(this)),t("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}}const wi=C(C({},Xe),{},{device(e,t,{shared:n,pointer:{touch:i=!1}={}}){if(n.target&&!z.touch&&z.gesture)return"gesture";if(z.touch&&i)return"touch";if(z.touchscreen){if(z.pointer)return"pointer";if(z.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:i={}}){const s=o=>{const a=$t(Et(n,o),{min:-1/0,max:1/0});return[a.min,a.max]},r=o=>{const a=$t(Et(i,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof i!="function"?[s(),r()]:o=>[s(o),r(o)]},threshold(e,t,n){return this.lockDirection=n.axis==="lock",I.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey(e){return e===void 0?"ctrlKey":e},pinchOnWheel(e=!0){return e}});class Ei extends ht{constructor(...t){super(...t),k(this,"ingKey","moving")}move(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues(Z(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const n=Z(t),i=this.state;i._delta=I.sub(n,i._values),I.addTo(i._movement,i._delta),this.computeValues(n),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}}const Mi=C(C({},W),{},{mouseOnly:(e=!0)=>e});class Ai extends ht{constructor(...t){super(...t),k(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const n=this.state,i=Qn(t);n._delta=I.sub(i,n._values),I.addTo(n._movement,n._delta),this.computeValues(i),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}}const Si=W;class Ii extends ht{constructor(...t){super(...t),k(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const n=this.state;n._delta=Fe(t),I.addTo(n._movement,n._delta),Qe(n),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}}const xi=W;class Oi extends ht{constructor(...t){super(...t),k(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&t.pointerType!=="mouse"||(this.start(t),this.computeValues(Z(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&t.pointerType!=="mouse")return;const n=this.state;if(!n._active)return;n._active=!1;const i=Z(t);n._movement=n._delta=I.sub(i,n._values),this.computeValues(i),this.compute(t),n.delta=n.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}}const Ti=C(C({},W),{},{mouseOnly:(e=!0)=>e}),Rt=new Map,Ct=new Map;function Ci(e){Rt.set(e.key,e.engine),Ct.set(e.key,e.resolver)}const Di={key:"drag",engine:ri,resolver:vi},Pi={key:"hover",engine:Oi,resolver:Ti},ki={key:"move",engine:Ei,resolver:Mi},Ri={key:"pinch",engine:bi,resolver:wi},Vi={key:"scroll",engine:Ai,resolver:Si},Li={key:"wheel",engine:Ii,resolver:xi};function ji(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,r;for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function zi(e,t){if(e==null)return{};var n=ji(e,t),i,s;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)i=r[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}const Bi={target(e){if(e)return()=>"current"in e?e.current:e},enabled(e=!0){return e},window(e=z.isBrowser?window:void 0){return e},eventOptions({passive:e=!0,capture:t=!1}={}){return{passive:e,capture:t}},transform(e){return e}},Ki=["target","eventOptions","window","enabled","transform"];function bt(e={},t){const n={};for(const[i,s]of Object.entries(t))switch(typeof s){case"function":n[i]=s.call(n,e[i],i,e);break;case"object":n[i]=bt(e[i],s);break;case"boolean":s&&(n[i]=e[i]);break}return n}function Ui(e,t,n={}){const i=e,{target:s,eventOptions:r,window:o,enabled:a,transform:c}=i,u=zi(i,Ki);if(n.shared=bt({target:s,eventOptions:r,window:o,enabled:a,transform:c},Bi),t){const l=Ct.get(t);n[t]=bt(C({shared:n.shared},u),l)}else for(const l in u){const d=Ct.get(l);d&&(n[l]=bt(C({shared:n.shared},u[l]),d))}return n}class Ze{constructor(t,n){k(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=n}add(t,n,i,s,r){const o=this._listeners,a=Fn(n,i),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=C(C({},c),r);t.addEventListener(a,s,u);const l=()=>{t.removeEventListener(a,s,u),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class Gi{constructor(){k(this,"_timeouts",new Map)}add(t,n,i=140,...s){this.remove(t),this._timeouts.set(t,window.setTimeout(n,i,...s))}remove(t){const n=this._timeouts.get(t);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class Yi{constructor(t){k(this,"gestures",new Set),k(this,"_targetEventStore",new Ze(this)),k(this,"gestureEventStores",{}),k(this,"gestureTimeoutStores",{}),k(this,"handlers",{}),k(this,"config",{}),k(this,"pointerIds",new Set),k(this,"touchIds",new Set),k(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Hi(this,t)}setEventIds(t){if(St(t))return this.touchIds=new Set($n(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,n){this.handlers=t,this.nativeHandlers=n}applyConfig(t,n){this.config=Ui(t,n,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const n=this.config.shared,i={};let s;if(!(n.target&&(s=n.target(),!s))){if(n.enabled){for(const o of this.gestures){const a=this.config[o],c=te(i,a.eventOptions,!!s);if(a.enabled){const u=Rt.get(o);new u(this,t,o).bind(c)}}const r=te(i,n.eventOptions,!!s);for(const o in this.nativeHandlers)r(o,"",a=>this.nativeHandlers[o](C(C({},this.state.shared),{},{event:a,args:t})),void 0,!0)}for(const r in i)i[r]=ti(...i[r]);if(!s)return i;for(const r in i){const{device:o,capture:a,passive:c}=Wn(r);this._targetEventStore.add(s,o,"",i[r],{capture:a,passive:c})}}}}function F(e,t){e.gestures.add(t),e.gestureEventStores[t]=new Ze(e,t),e.gestureTimeoutStores[t]=new Gi}function Hi(e,t){t.drag&&F(e,"drag"),t.wheel&&F(e,"wheel"),t.scroll&&F(e,"scroll"),t.move&&F(e,"move"),t.pinch&&F(e,"pinch"),t.hover&&F(e,"hover")}const te=(e,t,n)=>(i,s,r,o={},a=!1)=>{var c,u;const l=(c=o.capture)!==null&&c!==void 0?c:t.capture,d=(u=o.passive)!==null&&u!==void 0?u:t.passive;let b=a?i:Hn(i,s,l);n&&d&&(b+="Passive"),e[b]=e[b]||[],e[b].push(r)},Ni=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Wi(e){const t={},n={},i=new Set;for(let s in e)Ni.test(s)?(i.add(RegExp.lastMatch),n[s]=e[s]):t[s]=e[s];return[n,t,i]}function q(e,t,n,i,s,r){if(!e.has(n)||!Rt.has(i))return;const o=n+"Start",a=n+"End",c=u=>{let l;return u.first&&o in t&&t[o](u),n in t&&(l=t[n](u)),u.last&&a in t&&t[a](u),l};s[i]=c,r[i]=r[i]||{}}function Fi(e,t){const[n,i,s]=Wi(e),r={};return q(s,n,"onDrag","drag",r,t),q(s,n,"onWheel","wheel",r,t),q(s,n,"onScroll","scroll",r,t),q(s,n,"onPinch","pinch",r,t),q(s,n,"onMove","move",r,t),q(s,n,"onHover","hover",r,t),{handlers:r,config:t,nativeHandlers:i}}function qi(e,t={},n,i){const s=ut.useMemo(()=>new Yi(e),[]);if(s.applyHandlers(e,i),s.applyConfig(t,n),ut.useEffect(s.effect.bind(s)),ut.useEffect(()=>s.clean.bind(s),[]),t.target===void 0)return s.bind.bind(s)}function Xi(e){return e.forEach(Ci),function(n,i){const{handlers:s,nativeHandlers:r,config:o}=Fi(n,i||{});return qi(s,o,void 0,r)}}function $i(e,t){return Xi([Di,Ri,Vi,Li,ki,Pi])(e,t||{})}function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dt(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Qi(e,t){if(e){if(typeof e=="string")return Dt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dt(e,t)}}function Zi(e){if(Array.isArray(e))return Dt(e)}function Ji(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ts(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function es(e){return Zi(e)||Ji(e)||Qi(e)||ts()}new kt;new kt;function ns(e,t,n){return Math.max(t,Math.min(n,e))}function is(e,t){return ns(e-Math.floor(e/t)*t,0,t)}function ss(e,t){var n=is(t-e,Math.PI*2);return n>Math.PI&&(n-=Math.PI*2),n}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var j=function e(t,n,i){var s=this;Je(this,e),lt(this,"dot2",function(r,o){return s.x*r+s.y*o}),lt(this,"dot3",function(r,o,a){return s.x*r+s.y*o+s.z*a}),this.x=t,this.y=n,this.z=i},rs=[new j(1,1,0),new j(-1,1,0),new j(1,-1,0),new j(-1,-1,0),new j(1,0,1),new j(-1,0,1),new j(1,0,-1),new j(-1,0,-1),new j(0,1,1),new j(0,-1,1),new j(0,1,-1),new j(0,-1,-1)],ee=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],ne=new Array(512),ie=new Array(512),os=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var n=0;n<256;n++){var i;n&1?i=ee[n]^t&255:i=ee[n]^t>>8&255,ne[n]=ne[n+256]=i,ie[n]=ie[n+256]=rs[i%12]}};os(0);function as(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var n=0;n<t.length;n++)e=(e+(n+1)*(t.charCodeAt(n)%96))%2147483647}return e===0&&(e=311),e}function se(e){var t=as(e);return function(){var n=t*48271%2147483647;return t=n,n/2147483647}}var cs=function e(t){var n=this;Je(this,e),lt(this,"seed",0),lt(this,"init",function(i){n.seed=i,n.value=se(i)}),lt(this,"value",se(this.seed)),this.init(t)};new cs(Math.random());var us=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return i/Math.atan(1/n)*Math.atan(Math.sin(2*Math.PI*t*s)/n)},tn=function(t){return 1/(1+t+.48*t*t+.235*t*t*t)},ls=function(t){return t},fs={in:function(t){return 1-Math.cos(t*Math.PI/2)},out:function(t){return Math.sin(t*Math.PI/2)},inOut:function(t){return-(Math.cos(Math.PI*t)-1)/2}},hs={in:function(t){return t*t*t},out:function(t){return 1-Math.pow(1-t,3)},inOut:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}},ds={in:function(t){return t*t*t*t*t},out:function(t){return 1-Math.pow(1-t,5)},inOut:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}},ps={in:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},out:function(t){return Math.sqrt(1-Math.pow(t-1,2))},inOut:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}},ms={in:function(t){return t*t*t*t},out:function(t){return 1- --t*t*t*t},inOut:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t}},ys={in:function(t){return t===0?0:Math.pow(2,10*t-10)},out:function(t){return t===1?1:1-Math.pow(2,-10*t)},inOut:function(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}};function R(e,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:tn,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+t;if(e.__damp===void 0&&(e.__damp={}),e.__damp[c]===void 0&&(e.__damp[c]=0),Math.abs(e[t]-n)<=a)return e[t]=n,!1;i=Math.max(1e-4,i);var u=2/i,l=o(u*s),d=e[t]-n,b=n,E=r*i;d=Math.min(Math.max(d,-E),E),n=e[t]-d;var v=(e.__damp[c]+u*d)*s;e.__damp[c]=(e.__damp[c]-u*v)*l;var w=n+(d+v)*l;return b-e[t]>0==w>b&&(w=b,e.__damp[c]=(w-b)/s),e[t]=w,!0}var vs=function(t){return t&&t.isCamera},gs=function(t){return t&&t.isLight},nt=new N,re=new ft,oe=new ft,it=new Ue,xt=new N;function _s(e,t,n,i,s,r,o){typeof t=="number"?nt.setScalar(t):Array.isArray(t)?nt.set(t[0],t[1],t[2]):nt.copy(t);var a=e.parent;e.updateWorldMatrix(!0,!1),xt.setFromMatrixPosition(e.matrixWorld),vs(e)||gs(e)?it.lookAt(xt,nt,e.up):it.lookAt(nt,xt,e.up),Mt(e.quaternion,oe.setFromRotationMatrix(it),n,i,s,r,o),a&&(it.extractRotation(a.matrixWorld),re.setFromRotationMatrix(it),Mt(e.quaternion,oe.copy(e.quaternion).premultiply(re.invert()),n,i,s,r,o))}function Q(e,t,n,i,s,r,o,a){return R(e,t,e[t]+ss(e[t],n),i,s,r,o,a)}var st=new kt,ae,ce;function bs(e,t,n,i,s,r,o){return typeof t=="number"?st.setScalar(t):Array.isArray(t)?st.set(t[0],t[1]):st.copy(t),ae=R(e,"x",st.x,n,i,s,r,o),ce=R(e,"y",st.y,n,i,s,r,o),ae||ce}var X=new N,ue,le,fe;function Pt(e,t,n,i,s,r,o){return typeof t=="number"?X.setScalar(t):Array.isArray(t)?X.set(t[0],t[1],t[2]):X.copy(t),ue=R(e,"x",X.x,n,i,s,r,o),le=R(e,"y",X.y,n,i,s,r,o),fe=R(e,"z",X.z,n,i,s,r,o),ue||le||fe}var H=new At,he,de,pe,me;function ws(e,t,n,i,s,r,o){return typeof t=="number"?H.setScalar(t):Array.isArray(t)?H.set(t[0],t[1],t[2],t[3]):H.copy(t),he=R(e,"x",H.x,n,i,s,r,o),de=R(e,"y",H.y,n,i,s,r,o),pe=R(e,"z",H.z,n,i,s,r,o),me=R(e,"w",H.w,n,i,s,r,o),he||de||pe||me}var rt=new pn,ye,ve,ge;function Es(e,t,n,i,s,r,o){return Array.isArray(t)?rt.set(t[0],t[1],t[2],t[3]):rt.copy(t),ye=Q(e,"x",rt.x,n,i,s,r,o),ve=Q(e,"y",rt.y,n,i,s,r,o),ge=Q(e,"z",rt.z,n,i,s,r,o),ye||ve||ge}var $=new Ge,_e,be,we;function Ms(e,t,n,i,s,r,o){return t instanceof Ge?$.copy(t):Array.isArray(t)?$.setRGB(t[0],t[1],t[2]):$.set(t),_e=R(e,"r",$.r,n,i,s,r,o),be=R(e,"g",$.g,n,i,s,r,o),we=R(e,"b",$.b,n,i,s,r,o),_e||be||we}var B=new ft,U=new At,Ee=new At,ot=new At,Me,Ae,Se,Ie;function Mt(e,t,n,i,s,r,o){var a=e;Array.isArray(t)?B.set(t[0],t[1],t[2],t[3]):B.copy(t);var c=e.dot(B)>0?1:-1;return B.x*=c,B.y*=c,B.z*=c,B.w*=c,Me=R(e,"x",B.x,n,i,s,r,o),Ae=R(e,"y",B.y,n,i,s,r,o),Se=R(e,"z",B.z,n,i,s,r,o),Ie=R(e,"w",B.w,n,i,s,r,o),U.set(e.x,e.y,e.z,e.w).normalize(),Ee.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),ot.copy(U).multiplyScalar(Ee.dot(U)/U.dot(U)),a.__damp.velocity_x-=ot.x,a.__damp.velocity_y-=ot.y,a.__damp.velocity_z-=ot.z,a.__damp.velocity_w-=ot.w,e.set(U.x,U.y,U.z,U.w),Me||Ae||Se||Ie}var at=new dn,xe,Oe,Te;function As(e,t,n,i,s,r,o){return Array.isArray(t)?at.set(t[0],t[1],t[2]):at.copy(t),xe=R(e,"radius",at.radius,n,i,s,r,o),Oe=Q(e,"phi",at.phi,n,i,s,r,o),Te=Q(e,"theta",at.theta,n,i,s,r,o),xe||Oe||Te}var gt=new Ue,Ce=new N,De=new ft,Pe=new N,ke,Re,Ve;function Ss(e,t,n,i,s,r,o){var a=e;return a.__damp===void 0&&(a.__damp={position:new N,rotation:new ft,scale:new N},e.decompose(a.__damp.position,a.__damp.rotation,a.__damp.scale)),Array.isArray(t)?gt.set.apply(gt,es(t)):gt.copy(t),gt.decompose(Ce,De,Pe),ke=Pt(a.__damp.position,Ce,n,i,s,r,o),Re=Mt(a.__damp.rotation,De,n,i,s,r,o),Ve=Pt(a.__damp.scale,Pe,n,i,s,r,o),e.compose(a.__damp.position,a.__damp.rotation,a.__damp.scale),ke||Re||Ve}var Le=Object.freeze({__proto__:null,rsqw:us,exp:tn,linear:ls,sine:fs,cubic:hs,quint:ds,circ:ps,quart:ms,expo:ys,damp:R,dampLookAt:_s,dampAngle:Q,damp2:bs,damp3:Pt,damp4:ws,dampE:Es,dampC:Ms,dampQ:Mt,dampS:As,dampM:Ss});function Is(...e){const t=h.useRef([]);return t.current=e.map(n=>h.useContext(n)),h.useMemo(()=>({children:n})=>e.reduceRight((i,s,r)=>h.createElement(s.Provider,{value:t.current[r],children:i}),n),[])}const xs=(e,t,n)=>{const i=t-e;return((n-e)%i+i)%i+e};function en(e,t){return _n(e)?e[xs(0,e.length,t)]:e}class Os{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,n){for(let i=0;i<this.animations.length;i++)this.animations[i][t]=n}attachTimeline(t){const n=this.animations.map(i=>i.attachTimeline(t));return()=>{n.forEach((i,s)=>{i&&i(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return je(this.animations,"duration")}get iterationDuration(){return je(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(n=>n[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function je(e,t){let n=0;for(let i=0;i<e.length;i++){const s=e[i][t];s!==null&&s>n&&(n=s)}return n}class Ts extends Os{then(t,n){return this.finished.finally(t).then(()=>{})}}function Vt(e){return typeof e=="object"&&!Array.isArray(e)}function nn(e,t,n,i){return typeof e=="string"&&Vt(t)?bn(e,n,i):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function Cs(e,t,n){return e*(t+1)}function ze(e,t,n,i){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?n:t.startsWith("<")?Math.max(0,n+parseFloat(t.slice(1))):i.get(t)??e}function Ds(e,t,n){for(let i=0;i<e.length;i++){const s=e[i];s.at>t&&s.at<n&&(En(e,s),i--)}}function Ps(e,t,n,i,s,r){Ds(e,s,r);for(let o=0;o<t.length;o++)e.push({value:t[o],at:wn(s,r,i[o]),easing:en(n,o)})}function ks(e,t){for(let n=0;n<e.length;n++)e[n]=e[n]/(t+1)}function Rs(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const Vs="easeInOut";function Ls(e,{defaultTransition:t={},...n}={},i,s){const r=t.duration||.3,o=new Map,a=new Map,c={},u=new Map;let l=0,d=0,b=0;for(let E=0;E<e.length;E++){const v=e[E];if(typeof v=="string"){u.set(v,d);continue}else if(!Array.isArray(v)){u.set(v.name,ze(d,v.at,l,u));continue}let[w,p,g={}]=v;g.at!==void 0&&(d=ze(d,g.at,l,u));let _=0;const M=(A,x,f,m=0,T=0)=>{const y=js(A),{delay:V=0,times:D=Mn(y),type:P="keyframes",repeat:S,repeatType:O,repeatDelay:Y=0,...pt}=x;let{ease:G=t.ease||"easeOut",duration:K}=x;const Lt=typeof V=="function"?V(m,T):V,jt=y.length,zt=In(P)?P:s?.[P||"keyframes"];if(jt<=2&&zt){let J=100;if(jt===2&&Ks(y)){const tt=y[1]-y[0];J=Math.abs(tt)}const mt={...pt};K!==void 0&&(mt.duration=xn(K));const yt=An(mt,J,zt);G=yt.ease,K=yt.duration}K??(K=r);const Bt=d+Lt;D.length===1&&D[0]===0&&(D[1]=1);const Kt=D.length-y.length;if(Kt>0&&Sn(D,Kt),y.length===1&&y.unshift(null),S){K=Cs(K,S);const J=[...y],mt=[...D];G=Array.isArray(G)?[...G]:[G];const yt=[...G];for(let tt=0;tt<S;tt++){y.push(...J);for(let et=0;et<J.length;et++)D.push(mt[et]+(tt+1)),G.push(et===0?"linear":en(yt,et-1))}ks(D,S)}const Ut=Bt+K;Ps(f,y,G,D,Bt,Ut),_=Math.max(Lt+K,_),b=Math.max(Ut,b)};if(Ye(w)){const A=Be(w,a);M(p,g,Ke("default",A))}else{const A=nn(w,p,i,c),x=A.length;for(let f=0;f<x;f++){p=p,g=g;const m=A[f],T=Be(m,a);for(const y in p)M(p[y],zs(g,y),Ke(y,T),f,x)}}l=d,d+=_}return a.forEach((E,v)=>{for(const w in E){const p=E[w];p.sort(Rs);const g=[],_=[],M=[];for(let x=0;x<p.length;x++){const{at:f,value:m,easing:T}=p[x];g.push(m),_.push(On(0,b,f)),M.push(T||"easeOut")}_[0]!==0&&(_.unshift(0),g.unshift(g[0]),M.unshift(Vs)),_[_.length-1]!==1&&(_.push(1),g.push(null)),o.has(v)||o.set(v,{keyframes:{},transition:{}});const A=o.get(v);A.keyframes[w]=g,A.transition[w]={...t,duration:b,ease:M,times:_,...n}}}),o}function Be(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function Ke(e,t){return t[e]||(t[e]=[]),t[e]}function js(e){return Array.isArray(e)?e:[e]}function zs(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const Bs=e=>typeof e=="number",Ks=e=>e.every(Bs);function Us(e,t){return e in t}class Gs extends Tn{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,n){if(Us(n,t)){const i=t[n];if(typeof i=="string"||typeof i=="number")return i}}getBaseTargetFromProps(){}removeValueFromRenderState(t,n){delete n.output[t]}measureInstanceViewportBox(){return Cn()}build(t,n){Object.assign(t.output,n)}renderInstance(t,{output:n}){Object.assign(t,n)}sortInstanceNodePosition(){return 0}}function Ys(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},n=Dn(e)&&!Pn(e)?new kn(t):new Rn(t);n.mount(e),wt.set(e,n)}function Hs(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},n=new Gs(t);n.mount(e),wt.set(e,n)}function Ns(e,t){return Ye(e)||typeof e=="number"||typeof e=="string"&&!Vt(t)}function sn(e,t,n,i){const s=[];if(Ns(e,t))s.push(Vn(e,Vt(t)&&t.default||t,n&&(n.default||n)));else{const r=nn(e,t,i),o=r.length;for(let a=0;a<o;a++){const c=r[a],u=c instanceof Element?Ys:Hs;wt.has(c)||u(c);const l=wt.get(c),d={...n};"delay"in d&&typeof d.delay=="function"&&(d.delay=d.delay(a,o)),s.push(...Ln(l,{...t,transition:d},{}))}}return s}function Ws(e,t,n){const i=[];return Ls(e,t,n,{spring:jn}).forEach(({keyframes:r,transition:o},a)=>{i.push(...sn(a,r,o))}),i}function Fs(e){return Array.isArray(e)&&e.some(Array.isArray)}function qs(e){function t(n,i,s){let r=[],o;if(Fs(n))r=Ws(n,i,e);else{const{onComplete:c,...u}=s||{};typeof c=="function"&&(o=c),r=sn(n,i,u,e)}const a=new Ts(r);return o&&a.finished.then(o),a}return t}const _t=qs();function Xs({onMount:e,children:t}){return h.useEffect(()=>{e()},[e]),L.jsx(L.Fragment,{children:t})}function $s({module:e,targetPosition:t,isPresent:n,renderModel:i=!0,enterFrom:s,exitVia:r,offscreenPosition:o}){const a=ct(_=>_.invalidate),c=h.useRef(null),u=h.useRef(t),l=h.useRef(!1),d=h.useRef(n),b=h.useRef(n),E=h.useRef(0),v=h.useRef([]),w=h.useRef(n?1:0),p=h.useRef({}),g=h.useCallback(()=>{const _=c.current;if(!_||v.current.length>0)return;const M=new Set;if(_.traverse(A=>{const x=A;if(!x.isMesh)return;const f=x.material;if(f)if(Array.isArray(f)){const m=f.map(T=>T.clone());x.material=m,m.forEach(T=>M.add(T))}else{const m=f.clone();x.material=m,M.add(m)}}),M.size!==0){v.current=Array.from(M);for(const A of v.current)A.transparent=!0,A.opacity=w.current;a()}},[a]);return h.useEffect(()=>{const _=c.current;if(!_)return;i&&g();const M=S=>{w.current=S;for(const O of v.current)O.transparent=!0,O.opacity=S;a()},A=d.current;d.current=n,b.current=n;const[x,f,m]=t,T=!A&&n,y=A&&!n;if(!l.current){_.position.set(x,f,m),l.current=!0,a();return}if(T){const S=s??[x,f+1,m];M(0),_.position.set(S[0],S[1],S[2]),a()}p.current.x?.stop(),p.current.y?.stop(),p.current.z?.stop(),p.current.opacity?.stop();const V=y&&r?r:t,D={type:"spring",stiffness:220,damping:26,mass:.8,restDelta:.001,restSpeed:.01},P=E.current+=1;if(p.current.x=_t(_.position.x,V[0],{...D,onUpdate:S=>{const O=c.current;O&&(O.position.x=S),a()}}),p.current.y=_t(_.position.y,V[1],{...D,onUpdate:S=>{const O=c.current;O&&(O.position.y=S),a()}}),p.current.z=_t(_.position.z,V[2],{...D,onUpdate:S=>{const O=c.current;O&&(O.position.z=S),a()}}),T||y){const S=y?0:1;p.current.opacity=_t(w.current,S,{duration:.28,ease:"easeOut",onUpdate:O=>M(O)})}else M(n?1:0);if(y&&r){const S=[p.current.x?.finished,p.current.y?.finished,p.current.z?.finished,p.current.opacity?.finished].filter(Boolean);Promise.all(S).then(()=>{if(E.current!==P||b.current)return;const O=c.current;O&&(M(0),O.position.set(o[0],o[1],o[2]),a())}).catch(()=>{})}return()=>{p.current.x?.stop(),p.current.y?.stop(),p.current.z?.stop(),p.current.opacity?.stop()}},[i,s?.[0],s?.[1],s?.[2],r?.[0],r?.[1],r?.[2],n,o[0],o[1],o[2],t[0],t[1],t[2]]),L.jsx("group",{ref:c,position:u.current,children:i?L.jsx(ut.Suspense,{fallback:null,children:L.jsx(Xs,{onMount:g,children:e.model})}):null})}function Qs({enabled:e=!0,snap:t,global:n=!1,domElement:i,cursor:s=!0,children:r,speed:o=1,rotation:a=[0,0,0],zoom:c=1,polar:u=[0,Math.PI/2],azimuth:l=[-1/0,1/0],damping:d=.25}){const b=ct(y=>y.events),E=ct(y=>y.gl),{size:v}=ct(),w=ct(y=>y.invalidate),p=vn(),g=i||b.connected||E.domElement,_=h.useRef(!1),M=h.useMemo(()=>[a[0]+u[0],a[0]+u[1]],[u[0],u[1],a[0]]),A=h.useMemo(()=>[a[1]+l[0],a[1]+l[1]],[l[0],l[1],a[1]]),x=h.useMemo(()=>[vt.clamp(a[0],M[0],M[1]),vt.clamp(a[1],A[0],A[1]),a[2]],[A,M,a]);h.useEffect(()=>{if(p&&n&&s&&e)return g.style.cursor="grab",E.domElement.style.cursor="",()=>{g.style.cursor="default",E.domElement.style.cursor="default"}},[s,e,g,E.domElement,n,p]);const[f]=ut.useState({scale:1,rotation:x,damping:d}),m=h.useRef(null);h.useEffect(()=>{w()},[w]),gn((y,V)=>{if(!p||!m.current)return;Le.damp3(m.current.scale,f.scale,f.damping,V),Le.dampE(m.current.rotation,f.rotation,f.damping,V),Math.abs(m.current.scale.x-f.scale)>5e-4||Math.abs(m.current.rotation.x-(f.rotation?.[0]??0))>5e-4||Math.abs(m.current.rotation.y-(f.rotation?.[1]??0))>5e-4||Math.abs(m.current.rotation.z-(f.rotation?.[2]??0))>5e-4||_.current?w():_.current=!1}),h.useEffect(()=>{p&&w()},[w,p]);const T=$i({onHover:({last:y})=>{s&&!n&&e&&(g.style.cursor=y?"auto":"grab")},onDrag:({down:y,delta:[V,D],memo:[P,S]=f.rotation})=>{if(!e)return[D,V];s&&(g.style.cursor=y?"grabbing":"grab");const O=vt.clamp(S+V/v.width*Math.PI*o,A[0],A[1]),Y=vt.clamp(P+D/v.height*Math.PI*o,M[0],M[1]);return f.scale=y&&Y>M[1]/2?c:1,f.rotation=t&&!y?x:[Y,O,0],f.damping=t&&!y&&typeof t!="boolean"?t:d,_.current=y,p&&w(),[Y,O]}},{target:n?g:void 0});return L.jsx("group",{ref:m,...typeof T=="function"?T():{},children:r})}function Zs({modules:e,activeConfiguration:t,activeModuleSet:n,enterFromByModule:i,exitViaByModule:s,offscreenPosition:r,worldOffset:o}){const a=h.useRef(new Set),c=h.useRef(null),[u,l]=h.useState(!0),d=h.useRef(!0),b=Is(Gt);return h.useEffect(()=>{for(const E of n)a.current.add(E)},[n]),h.useEffect(()=>{if(typeof window>"u")return;const E=c.current;if(!E||typeof IntersectionObserver>"u")return;const v=g=>{d.current=g;const _=typeof document>"u"||document.visibilityState==="visible";l(g&&_)},w=new IntersectionObserver(([g])=>{g&&v(g.isIntersecting)},{rootMargin:"200px"});w.observe(E);const p=()=>{v(d.current)};return document.addEventListener("visibilitychange",p),()=>{w.disconnect(),document.removeEventListener("visibilitychange",p)}},[]),L.jsx("div",{ref:c,className:"w-full h-full",children:L.jsx(Gt.Provider,{value:u,children:L.jsx(mn,{shadows:!0,className:"touch-none",camera:{fov:50,position:[0,1.5,8]},frameloop:"demand",dpr:[1,1.5],gl:{powerPreference:"high-performance"},children:L.jsxs(b,{children:[L.jsx("ambientLight",{intensity:.5}),L.jsx("spotLight",{position:[10,10,10],angle:.15,penumbra:1,"shadow-mapSize":2048,castShadow:!0}),L.jsx(Qs,{global:!0,damping:.2,snap:!0,polar:[-Math.PI/3,Math.PI/3],azimuth:[-Math.PI/1.4,Math.PI/2],children:L.jsx("group",{position:o,rotation:[.1,-.4,0],children:Object.entries(e).map(([E,v])=>{const p=t?.modulePositions?.[v.id]??void 0??r,g=n.has(v.id),_=g||!!s[v.id]||a.current.has(v.id);return L.jsx($s,{module:v,targetPosition:p,isPresent:g,renderModel:_,enterFrom:i[v.id],exitVia:s[v.id],offscreenPosition:r},E)})})}),L.jsx(yn,{preset:"city"})]})})})})}function Js(e,t){return!(e.modules!==t.modules||e.activeConfiguration!==t.activeConfiguration||e.activeModuleSet!==t.activeModuleSet||e.enterFromByModule!==t.enterFromByModule||e.exitViaByModule!==t.exitViaByModule||e.offscreenPosition[0]!==t.offscreenPosition[0]||e.offscreenPosition[1]!==t.offscreenPosition[1]||e.offscreenPosition[2]!==t.offscreenPosition[2]||e.worldOffset[0]!==t.worldOffset[0]||e.worldOffset[1]!==t.worldOffset[1]||e.worldOffset[2]!==t.worldOffset[2])}const ur=h.memo(Zs,Js);function tr(e,t){for(const n of e)if(!t.has(n))return!1;return!0}function lr(e,t){let n=0;for(const i of e)t.has(i)||(n+=1);return n}function fr(e,t){return e.size===t.size&&tr(e,t)}function er(e){return new Set(e)}function Ot(e,t,n){return Math.min(Math.max(e,t),n)}function rn(e){if(e.length===0)return null;let t=e[0][0],n=e[0][1],i=e[0][2],s=e[0][0],r=e[0][1],o=e[0][2];for(const[l,d,b]of e)t=Math.min(t,l),n=Math.min(n,d),i=Math.min(i,b),s=Math.max(s,l),r=Math.max(r,d),o=Math.max(o,b);const a=s-t,c=r-n,u=o-i;return{min:[t,n,i],max:[s,r,o],diagonal:Math.hypot(a,c,u)}}function on(e,t){return[Ot(e[0],t.min[0],t.max[0]),Ot(e[1],t.min[1],t.max[1]),Ot(e[2],t.min[2],t.max[2])]}function an(e,t){return e[0]>=t.min[0]&&e[0]<=t.max[0]&&e[1]>=t.min[1]&&e[1]<=t.max[1]&&e[2]>=t.min[2]&&e[2]<=t.max[2]}function cn(e){const t=Math.hypot(e[0],e[1],e[2]);return t<1e-6?[0,1,0]:[e[0]/t,e[1]/t,e[2]/t]}function un(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function ln(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function fn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function hn(e,t){return Object.entries(e.modulePositions??{}).flatMap(([n,i])=>n===t||!i?[]:[i])}function nr(e,t,n){const i=rn(hn(e,t)),s=Math.max(.9,(i?.diagonal??0)*.35);if(!i||an(n,i)){const a=(i?.max[1]??n[1])+s;return[n[0],a,n[2]]}const r=on(n,i),o=cn(ln(n,r));return un(n,fn(o,s))}function ir(e,t,n){const i=rn(hn(e,t)),s=Math.max(1.15,(i?.diagonal??0)*.55);if(!i||an(n,i)){const a=(i?.max[1]??n[1])+s;return[n[0],a,n[2]]}const r=on(n,i),o=cn(ln(n,r));return un(n,fn(o,s))}function hr({modules:e,configurations:t,initialConfigurationId:n,urlSync:i=!1,urlParam:s="config",urlHistoryMode:r="replace"}){const o=h.useMemo(()=>Object.values(e),[e]),a=h.useMemo(()=>Object.entries(t).map(([f,m])=>({id:f,cfg:m})),[t]),c=h.useMemo(()=>n&&t[n]?n:a.length===0?"":a.reduce((m,T)=>{if(!m)return T;const y=Object.keys(m.cfg.modulePositions??{}).length;return Object.keys(T.cfg.modulePositions??{}).length>y?T:m},a[0])?.id??a[0].id,[a,t,n]),[u,l]=h.useState(c),d=h.useRef(u);h.useEffect(()=>{d.current=u},[u]);const[b,E]=h.useState({}),[v,w]=h.useState({}),p=h.useRef(c),g=h.useRef(!1),_=h.useRef(!1),M=h.useCallback(f=>{const m=d.current;if(!f||f===m)return;const T=t[m],y=t[f];if(!T||!y){E({}),w({}),l(f),d.current=f;return}const V={},D={};for(const P of o){const S=T.modulePositions?.[P.id],O=y.modulePositions?.[P.id],Y=!!S,pt=!!O;!Y&&pt&&O?V[P.id]=P.enterFrom?P.enterFrom:nr(y,P.id,O):Y&&!pt&&S&&(D[P.id]=P.exitTo?P.exitTo:P.enterFrom?P.enterFrom:ir(T,P.id,S))}E(V),w(D),l(f),d.current=f},[t,o]);h.useEffect(()=>{if(!i||typeof window>"u"||_.current)return;_.current=!0;const m=new URLSearchParams(window.location.search).get(s);m&&t[m]&&M(m)},[t,M,s,i]),h.useEffect(()=>{if(!c)return;const f=!!t[u],m=p.current!==c;(!f||m)&&(p.current=c,M(c))},[u,t,c,M]),h.useEffect(()=>{if(!i||typeof window>"u")return;if(!g.current){g.current=!0;return}if(!u)return;const f=new URL(window.location.href);if(f.searchParams.get(s)===u)return;f.searchParams.set(s,u);const m=f.toString();r==="push"?window.history.pushState({},"",m):window.history.replaceState({},"",m)},[u,r,s,i]);const A=h.useMemo(()=>{const f=t[u];return f||a[0]?.cfg},[u,t,a]),x=h.useMemo(()=>er(Object.keys(A?.modulePositions??{})),[A]);return{moduleList:o,configurationEntries:a,activeConfigurationId:u,activeConfiguration:A,activeModuleSet:x,enterFromByModule:b,exitViaByModule:v,setConfigurationId:M}}export{ur as C,cr as D,lr as a,fr as b,tr as i,er as s,hr as u};
//# sourceMappingURL=useConfigurator3DState.M1Ft5DAK.js.map
