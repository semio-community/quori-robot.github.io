import{j as a}from"./jsx-runtime.D_zvdyIk.js";import{R as m,r as s}from"./index.CC6F48bw.js";import{m as E,D as l,k as R,l as M,u as I,c as w,n as L,e as x}from"./spec.pnJrXtEp.js";const C=e=>e;function P(e,t=C){const r=m.useSyncExternalStore(e.subscribe,m.useCallback(()=>t(e.getState()),[e,t]),m.useCallback(()=>t(e.getInitialState()),[e,t]));return m.useDebugValue(r),r}const y=e=>{const t=E(e),r=n=>P(t,n);return Object.assign(r,t),r},A=(e=>e?y(e):y);let i=0;const D=A(e=>(l.onStart=(t,r,n)=>{e({active:!0,item:t,loaded:r,total:n,progress:(r-i)/(n-i)*100})},l.onLoad=()=>{e({active:!1})},l.onError=t=>e(r=>({errors:[...r.errors,t]})),l.onProgress=(t,r,n)=>{r===n&&(i=n),e({active:!0,item:t,loaded:r,total:n,progress:(r-i)/(n-i)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),b=1024,F=[.1,.3,0];function k({moduleId:e}){const t=s.useRef(null),{camera:r}=I(),{active:n}=D(),o=s.useRef(!1),h=s.useMemo(()=>w[e]??w.head??null,[e]);return s.useEffect(()=>{o.current=!1},[e]),s.useEffect(()=>{let c=0;const d=()=>{if(o.current)return;if(n){c=window.requestAnimationFrame(d);return}if(!t.current){c=window.requestAnimationFrame(d);return}const p=new L().setFromObject(t.current);if(p.isEmpty()){c=window.requestAnimationFrame(d);return}const g=p.getSize(new x),S=p.getCenter(new x);t.current.position.sub(S);const v=Math.max(g.x,g.y,g.z),u=r,j=u.fov*Math.PI/180;let f=v/(2*Math.tan(j/2));f*=1.35,u.position.set(0,0,f),u.near=Math.max(.01,f/10),u.far=f*10,u.updateProjectionMatrix(),u.lookAt(0,0,0),o.current=!0,document.body.dataset.ready="true"};return d(),()=>{c&&window.cancelAnimationFrame(c)}},[n,r]),h?a.jsx("group",{ref:t,rotation:F,children:h.model}):null}function V({moduleId:e="head"}){const[t,r]=s.useState(()=>typeof window>"u"?e:new URLSearchParams(window.location.search).get("id")||e);return s.useEffect(()=>{const o=new URLSearchParams(window.location.search).get("id");o&&o!==t&&r(o)},[e,t]),s.useEffect(()=>(document.body.dataset.ready="false",()=>{document.body.dataset.ready="false"}),[t]),a.jsx("div",{style:{width:`${b}px`,height:`${b}px`,margin:"0 auto"},children:a.jsxs(R,{shadows:!0,gl:{alpha:!0,preserveDrawingBuffer:!0},dpr:[1,2],camera:{fov:35,position:[0,0,4],near:.01,far:100},onCreated:({gl:n})=>{n.setClearColor(0,0)},children:[a.jsx("ambientLight",{intensity:.5}),a.jsx("spotLight",{position:[10,10,10],angle:.15,penumbra:1,castShadow:!0}),a.jsx(s.Suspense,{fallback:null,children:a.jsx(k,{moduleId:t})}),a.jsx(M,{preset:"city"})]})})}export{V as default};
//# sourceMappingURL=ModuleRenderPage.91DVoAbj.js.map
