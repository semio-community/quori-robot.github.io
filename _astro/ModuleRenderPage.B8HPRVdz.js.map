{"version":3,"file":"ModuleRenderPage.B8HPRVdz.js","sources":["../../node_modules/zustand/esm/react.mjs","../../node_modules/@react-three/drei/core/Progress.js","../../src/react-pages/tools/ModuleRenderPage.tsx"],"sourcesContent":["import React from 'react';\nimport { createStore } from 'zustand/vanilla';\n\nconst identity = (arg) => arg;\nfunction useStore(api, selector = identity) {\n  const slice = React.useSyncExternalStore(\n    api.subscribe,\n    React.useCallback(() => selector(api.getState()), [api, selector]),\n    React.useCallback(() => selector(api.getInitialState()), [api, selector])\n  );\n  React.useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  const api = createStore(createState);\n  const useBoundStore = (selector) => useStore(api, selector);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = ((createState) => createState ? createImpl(createState) : createImpl);\n\nexport { create, useStore };\n","import * as React from 'react';\nimport { DefaultLoadingManager } from 'three';\nimport { create } from 'zustand';\n\nlet saveLastTotalLoaded = 0;\nconst useProgress = /* @__PURE__ */create(set => {\n  DefaultLoadingManager.onStart = (item, loaded, total) => {\n    set({\n      active: true,\n      item,\n      loaded,\n      total,\n      progress: (loaded - saveLastTotalLoaded) / (total - saveLastTotalLoaded) * 100\n    });\n  };\n  DefaultLoadingManager.onLoad = () => {\n    set({\n      active: false\n    });\n  };\n  DefaultLoadingManager.onError = item => set(state => ({\n    errors: [...state.errors, item]\n  }));\n  DefaultLoadingManager.onProgress = (item, loaded, total) => {\n    if (loaded === total) {\n      saveLastTotalLoaded = total;\n    }\n    set({\n      active: true,\n      item,\n      loaded,\n      total,\n      progress: (loaded - saveLastTotalLoaded) / (total - saveLastTotalLoaded) * 100 || 100\n    });\n  };\n  return {\n    errors: [],\n    active: false,\n    progress: 0,\n    item: '',\n    loaded: 0,\n    total: 0\n  };\n});\n\n//\n\nfunction Progress({\n  children\n}) {\n  const result = useProgress();\n  return /*#__PURE__*/React.createElement(React.Fragment, null, children == null ? void 0 : children(result));\n}\n\nexport { Progress, useProgress };\n","import React, { Suspense, useEffect, useMemo, useRef, useState } from \"react\";\nimport { Canvas, useThree } from \"@react-three/fiber\";\nimport { Box3, Vector3, type PerspectiveCamera, type Group } from \"three\";\nimport { configurator3DModules } from \"@/react-pages/features/sections/configurator3d/spec\";\nimport { Environment, useProgress } from \"@react-three/drei\";\n\nconst VIEW_SIZE = 1024;\nconst VIEW_ROTATION: [number, number, number] = [0.1, 0.3, 0];\n\nfunction ModuleScene({ moduleId }: { moduleId: string }) {\n  const groupRef = useRef<Group>(null);\n  const { camera } = useThree();\n  const { active } = useProgress();\n  const hasFramedRef = useRef(false);\n\n  const module = useMemo(() => {\n    return (\n      configurator3DModules[moduleId] ?? configurator3DModules.head ?? null\n    );\n  }, [moduleId]);\n\n  useEffect(() => {\n    hasFramedRef.current = false;\n  }, [moduleId]);\n\n  useEffect(() => {\n    let rafId = 0;\n\n    const frameOnceReady = () => {\n      if (hasFramedRef.current) return;\n      if (active) {\n        rafId = window.requestAnimationFrame(frameOnceReady);\n        return;\n      }\n      if (!groupRef.current) {\n        rafId = window.requestAnimationFrame(frameOnceReady);\n        return;\n      }\n\n      const box = new Box3().setFromObject(groupRef.current);\n      if (box.isEmpty()) {\n        rafId = window.requestAnimationFrame(frameOnceReady);\n        return;\n      }\n\n      const size = box.getSize(new Vector3());\n      const center = box.getCenter(new Vector3());\n      groupRef.current.position.sub(center);\n\n      const maxDim = Math.max(size.x, size.y, size.z);\n      const perspective = camera as PerspectiveCamera;\n      const fov = (perspective.fov * Math.PI) / 180;\n      let distance = maxDim / (2 * Math.tan(fov / 2));\n      distance *= 1.35;\n\n      perspective.position.set(0, 0, distance);\n      perspective.near = Math.max(0.01, distance / 10);\n      perspective.far = distance * 10;\n      perspective.updateProjectionMatrix();\n      perspective.lookAt(0, 0, 0);\n\n      hasFramedRef.current = true;\n      document.body.dataset.ready = \"true\";\n    };\n\n    frameOnceReady();\n    return () => {\n      if (rafId) window.cancelAnimationFrame(rafId);\n    };\n  }, [active, camera]);\n\n  if (!module) return null;\n\n  return (\n    <group ref={groupRef} rotation={VIEW_ROTATION} children={module.model} />\n  );\n}\n\nexport default function ModuleRenderPage({\n  moduleId: initialModuleId = \"head\",\n}: {\n  moduleId?: string;\n}) {\n  const [moduleId, setModuleId] = useState(() => {\n    if (typeof window === \"undefined\") return initialModuleId;\n    const params = new URLSearchParams(window.location.search);\n    return params.get(\"id\") || initialModuleId;\n  });\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const queryModuleId = params.get(\"id\");\n    if (queryModuleId && queryModuleId !== moduleId) {\n      setModuleId(queryModuleId);\n    }\n  }, [initialModuleId, moduleId]);\n\n  useEffect(() => {\n    document.body.dataset.ready = \"false\";\n    return () => {\n      document.body.dataset.ready = \"false\";\n    };\n  }, [moduleId]);\n\n  return (\n    <div\n      style={{\n        width: `${VIEW_SIZE}px`,\n        height: `${VIEW_SIZE}px`,\n        margin: \"0 auto\",\n      }}\n    >\n      <Canvas\n        shadows\n        gl={{ alpha: true, preserveDrawingBuffer: true }}\n        dpr={[1, 2]}\n        camera={{ fov: 35, position: [0, 0, 4], near: 0.01, far: 100 }}\n        onCreated={({ gl }) => {\n          gl.setClearColor(0x000000, 0);\n        }}\n      >\n        <ambientLight intensity={0.5} />\n        <spotLight\n          position={[10, 10, 10]}\n          angle={0.15}\n          penumbra={1}\n          castShadow\n        />\n        <Suspense fallback={null}>\n          <ModuleScene moduleId={moduleId} />\n        </Suspense>\n        <Environment preset=\"city\" />\n      </Canvas>\n    </div>\n  );\n}\n"],"names":["identity","arg","useStore","api","selector","slice","React","createImpl","createState","createStore","useBoundStore","create","saveLastTotalLoaded","useProgress","set","DefaultLoadingManager","item","loaded","total","state","VIEW_SIZE","VIEW_ROTATION","ModuleScene","moduleId","groupRef","useRef","camera","useThree","active","hasFramedRef","module","useMemo","configurator3DModules","useEffect","rafId","frameOnceReady","box","Box3","size","Vector3","center","maxDim","perspective","fov","distance","jsx","ModuleRenderPage","initialModuleId","setModuleId","useState","queryModuleId","jsxs","Canvas","gl","Suspense","Environment"],"mappings":"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","x_google_ignoreList":[0,1]}